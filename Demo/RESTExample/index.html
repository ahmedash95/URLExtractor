<!DOCTYPE html>
<!--[if IE 8]> <html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en" >
	<!--<![endif]-->

	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width" />
		<title>URL Extractor Demo</title>
		<link rel="stylesheet" href="assets/css/foundation.css" />
		<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>
		<script src="assets/js/vendor/custom.modernizr.js"></script>
	</head>
	<body>

		<div class="panel" style="display: block; width: 500px; margin: 150px auto;">
			<div class="row">
				<div class="large-9 columns">
					<input type="text" placeholder="Insert the url to extract data..." id ="url" name="url">
				</div>
				<div class="large-3 columns">
					<a href="#" class="small button" id="get_info">Get Info</a>
				</div>
			</div>
				
			<div class="row" style="height: 10px;"> </div>
			
			<div class="row" id="url_info" style="display: none;">
				<div class="large-4 columns">
					<div class="row" style="display: block; height: 150px;">
						<a class="th radius">
							<img id="url_images" src="" style="width: 100%; max-height: 135px;">
						</a>
					</div>
					<div class="row" style="text-align: center; margin-top: 2px;">
						<a href="#" class="tiny button secondary" id="prev_image"><<</a> <a href="#" class="tiny button secondary" id="next_image">>></a>
					</div>
				</div>
				<div class="large-8 columns">
					<div class="row" style="margin-left: 3px;">
						<span style="font-weight: bold;">Title: </span> <span id="url_title"> </span>
					</div>
					<div class="row" style="margin-left: 3px;">
						<span style="font-weight: bold;">Descriptions: </span> <span id="url_description"> </span>
					</div>
					<div class="row" style="margin-left: 3px;">
						<span style="font-weight: bold;">keywords: </span> <span id="url_keywords"> </span>
					</div>
				</div>
			</div>
			
			<div class="row" id="url_loading" style="display: none;">
				<div class="large-12 columns">
					<img id="loading_gif" src="assets/img/loading.gif" style="display: block; margin: 10px auto; width: 80px; height: 80px;">
				</div>
			</div>
			
			<div class="row" id="url_error" style="display: none;">
				<div class="large-12 columns">
					<span id="error_msg" style="display: block; width: 100%; text-align: center;"> </span>
				</div>
			</div>
			
		</div>

		<script>
			document.write('<script src=' + ('__proto__' in {} ? 'assets/js/vendor/zepto' : 'assets/js/vendor/jquery') + '.js><\/script>')
		</script>

		<script src="assets/js/foundation.min.js"></script>

		<!--

		<script src="assets/js/foundation/foundation.js"></script>

		<script src="assets/js/foundation/foundation.placeholder.js"></script>

		-->

		<script>
			$(document).foundation();
		</script>

		<script>
			var images = new Array();
			var curImage = 0;
			
			$(document).ready(function() {
				
				$("#get_info").click(function(e) {
					e.preventDefault();
					
					/* Clear old images information and clear previous info */
					images.length = 0;
					curImage = 0;	
					$('#url_info').css("display", "none");
					$("#url_error").css("display", "none");
					$("#url_loading").css("display", "");
								
					$.ajax({
						type : "POST",
						contentType : 'application/json',
						url : "RESTAPI/url",
						dataType : "json",
						data : JSON.stringify({
							url : $("#url").val()
						})
					}).done(function(msg) {
						
						if (msg.error === undefined) {
						
						$("#url_title").html(msg.title);
						$("#url_description").html(msg.description);
						$("#url_keywords").html(msg.keywords.join(", "));
						
						images = filterImages(msg.images, 50);
						$("#url_images").attr("src", images[0]);
						
						$("#url_loading").css("display", "none");
						$("#url_error").css("display", "none");
						$("#url_info").css("display", "");
						
						} else {
							$("#url_loading").css("display", "none");
							$("#url_info").css("display", "none");
							$("#error_msg").html(msg.error + "...");
							$("#url_error").css("display", "");
						}
					});
				});
				
				$("#prev_image").click(function(e) {
					e.preventDefault();
					curImage--;
					if (curImage < 0) {
						curImage = images.length - 1;
					}
					$("#url_images").attr("src", images[curImage]);
				});
				
				$("#next_image").click(function(e) {
					e.preventDefault();
					curImage++;
					if (curImage > images.length - 1) {
						curImage = 0;
					}
					$("#url_images").attr("src", images[curImage]);
				});
				
			});
			
			function filterImages(images, size) {
				
				imagesFiltered = new Array();
				
				for (var i = 0; i < images.length; i++) {

					if (checkImageSize(images[i], size)) {
						imagesFiltered.push(images[i]);
					}
				}			
				
				return imagesFiltered;
			}
			
			function checkImageSize(image, size) {
				var tmpImg = new Image();
			    tmpImg.src = image;
			    orgWidth = tmpImg.width;
			    orgHeight = tmpImg.height;
			    return (orgWidth > size || orgHeight > size) ? true : false;
			}
		</script>

	</body>
</html>